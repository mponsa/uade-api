IF  NOT EXISTS (SELECT 1 FROM sys.databases WHERE name = N'API_GRUPO_25')
    BEGIN
        CREATE DATABASE [API_GRUPO_25]
    END;

CREATE LOGIN GRUPO_25  with 
			PASSWORD = 'GRUPO_25', 
			DEFAULT_DATABASE = API_GRUPO_25,
			CHECK_POLICY = off;
GO

CREATE USER GRUPO_25 FOR LOGIN GRUPO_25 WITH DEFAULT_SCHEMA = API_GRUPO_25;
GO

USE [API_GRUPO_25]


sp_addrolemember 'db_owner', 'GRUPO_25'
GO

EXEC SP_CHANGEDBOWNER 'GRUPO_25' 



IF  NOT EXISTS (SELECT 1 FROM sys.databases WHERE name = N'Usuarios')
BEGIN
	CREATE TABLE dbo.Usuarios(
		IdUsuario int IDENTITY(1,1),
		Nombre VARCHAR(20) not null,
		Apellido VARCHAR(20) not null, 
		FechaNac DATETIME not null,
		Mail VARCHAR(30) not null,
		Pass VARCHAR(20) not null,
		Activo BIT not null,

		CONSTRAINT pk_usuarios PRIMARY KEY (Mail)
	);
END;

CREATE TABLE dbo.ListaDeRegalo
(
		IdLista int IDENTITY(1,1),
		Nombre VARCHAR(20) not null, 
		Vigencia DATETIME not null,
		Agasajado VARCHAR(30) not null,
		Monto decimal, 
		Estado bit not null,
		Activo bit not null,
		MontoXParticipante decimal not null,


		CONSTRAINT pk_listas PRIMARY KEY (IdLista)
);

CREATE TABLE dbo.Participantes(
		IdLista int  foreign  key references dbo.ListaDeRegalo (IdLista),
		MailUsuario varchar(30) foreign  key references dbo.Usuarios (Mail),
		IsAdmin BIT not null,
		Pagado BIT not null,
		

		CONSTRAINT pk_participante PRIMARY KEY (IdLista, MailUsuario)
	);